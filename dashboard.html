<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tweet Analyzer — Top Performers</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #050505;
      --bg-secondary: #0d0d0d;
      --bg-card: #111111;
      --bg-card-hover: #1a1a1a;
      --border: #222;
      --text-primary: #f0f0f0;
      --text-secondary: #888;
      --text-muted: #555;
      --accent-likes: #fbbf24;
      --accent-rts: #3b82f6;
      --accent-views: #06b6d4;
      --accent-saves: #a855f7;
      --accent-replies: #22c55e;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Space Mono', monospace;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      padding: 20px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
    }

    .logo {
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--accent-likes), var(--accent-views));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stats-bar {
      display: flex;
      gap: 32px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .stat {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .stat-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .stat-label {
      color: var(--text-muted);
    }

    /* Layout */
    .container {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: calc(100vh - 80px);
    }

    /* Sidebar */
    .sidebar {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 24px;
      position: sticky;
      top: 80px;
      height: calc(100vh - 80px);
      overflow-y: auto;
    }

    .filter-section {
      margin-bottom: 32px;
    }

    .filter-title {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .author-filters {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .author-checkbox {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background 0.2s;
      font-size: 0.85rem;
    }

    .author-checkbox:hover {
      background: var(--bg-card);
    }

    .author-checkbox input {
      accent-color: var(--accent-likes);
      width: 16px;
      height: 16px;
    }

    .author-checkbox .count {
      margin-left: auto;
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    /* Sort & Filter Controls */
    .control-group {
      margin-bottom: 16px;
    }

    .control-label {
      display: block;
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    select, input[type="number"], input[type="date"] {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    select:hover, input:hover {
      border-color: var(--text-muted);
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--accent-likes);
    }

    .range-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    /* Main Content */
    .main {
      padding: 24px 32px;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .results-count {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .results-count span {
      color: var(--accent-likes);
      font-weight: 700;
    }

    /* Tweet Cards */
    .tweets-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .tweet-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px 24px;
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .tweet-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, var(--accent-likes), var(--accent-views));
      opacity: 0;
      transition: opacity 0.2s;
    }

    .tweet-card:hover {
      background: var(--bg-card-hover);
      border-color: var(--text-muted);
      transform: translateX(4px);
    }

    .tweet-card:hover::before {
      opacity: 1;
    }

    .tweet-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .tweet-author {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--accent-views);
    }

    .tweet-date {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .tweet-text {
      font-size: 0.95rem;
      line-height: 1.7;
      color: var(--text-primary);
      margin-bottom: 16px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .tweet-metrics {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .metric {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
    }

    .metric-icon {
      width: 16px;
      height: 16px;
      opacity: 0.8;
    }

    .metric-likes { color: var(--accent-likes); }
    .metric-rts { color: var(--accent-rts); }
    .metric-views { color: var(--accent-views); }
    .metric-saves { color: var(--accent-saves); }
    .metric-replies { color: var(--accent-replies); }

    .tweet-link {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .tweet-link a {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.2s;
    }

    .tweet-link a:hover {
      color: var(--accent-likes);
    }

    /* Rank Badge */
    .rank-badge {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 50%;
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .rank-badge.top-10 {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border: none;
      color: #000;
    }

    .rank-badge.top-50 {
      background: var(--bg-secondary);
      border-color: var(--accent-likes);
      color: var(--accent-likes);
    }

    /* Load More */
    .load-more {
      display: flex;
      justify-content: center;
      padding: 32px;
    }

    .load-more-btn {
      padding: 14px 32px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .load-more-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--accent-likes);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 64px 32px;
      color: var(--text-muted);
    }

    .empty-state h3 {
      font-family: 'Syne', sans-serif;
      font-size: 1.25rem;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    /* Reset Button */
    .reset-btn {
      width: 100%;
      padding: 10px;
      background: transparent;
      border: 1px dashed var(--border);
      border-radius: 6px;
      color: var(--text-muted);
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 16px;
    }

    .reset-btn:hover {
      border-color: var(--accent-likes);
      color: var(--accent-likes);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: static;
        height: auto;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      .stats-bar {
        display: none;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">TWEET ANALYZER</div>
    <div class="stats-bar">
      <div class="stat">
        <span class="stat-value" id="total-tweets">0</span>
        <span class="stat-label">Tweets</span>
      </div>
      <div class="stat">
        <span class="stat-value" id="total-likes">0</span>
        <span class="stat-label">Total Likes</span>
      </div>
      <div class="stat">
        <span class="stat-value" id="showing-count">0</span>
        <span class="stat-label">Showing</span>
      </div>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <div class="filter-section">
        <h3 class="filter-title">Authors</h3>
        <div class="author-filters" id="author-filters">
          <!-- Generated by JS -->
        </div>
      </div>

      <div class="filter-section">
        <h3 class="filter-title">Sort By</h3>
        <div class="control-group">
          <select id="sort-by">
            <option value="likes">Likes (High → Low)</option>
            <option value="likes-asc">Likes (Low → High)</option>
            <option value="views">Views (High → Low)</option>
            <option value="rts">Retweets (High → Low)</option>
            <option value="saves">Saves (High → Low)</option>
            <option value="date-new">Date (Newest)</option>
            <option value="date-old">Date (Oldest)</option>
            <option value="engagement-rate">Engagement Rate</option>
          </select>
        </div>
      </div>

      <div class="filter-section">
        <h3 class="filter-title">Min Engagement</h3>
        <div class="control-group">
          <label class="control-label">Min Likes</label>
          <input type="number" id="min-likes" placeholder="0" min="0">
        </div>
        <div class="control-group">
          <label class="control-label">Min Views</label>
          <input type="number" id="min-views" placeholder="0" min="0">
        </div>
        <div class="control-group">
          <label class="control-label">Min Saves</label>
          <input type="number" id="min-saves" placeholder="0" min="0">
        </div>
      </div>

      <div class="filter-section">
        <h3 class="filter-title">Date Range</h3>
        <div class="control-group">
          <label class="control-label">From</label>
          <input type="date" id="date-from">
        </div>
        <div class="control-group">
          <label class="control-label">To</label>
          <input type="date" id="date-to">
        </div>
      </div>

      <div class="filter-section">
        <h3 class="filter-title">Search</h3>
        <div class="control-group">
          <input type="text" id="search-text" placeholder="Search tweets...">
        </div>
      </div>

      <button class="reset-btn" id="reset-filters">Reset All Filters</button>
    </aside>

    <main class="main">
      <div class="results-header">
        <div class="results-count">
          Showing <span id="visible-count">0</span> of <span id="filtered-count">0</span> tweets
        </div>
      </div>
      <div class="tweets-grid" id="tweets-grid">
        <!-- Generated by JS -->
      </div>
      <div class="load-more" id="load-more" style="display: none;">
        <button class="load-more-btn" id="load-more-btn">Load More</button>
      </div>
    </main>
  </div>

  <script>
    // Tweet data will be loaded from file
    let TWEETS = [];
    const BATCH_SIZE = 50;
    let currentBatch = 0;
    let filteredTweets = [];

    // Format numbers
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    // Parse date string
    function parseDate(dateStr) {
      return new Date(dateStr);
    }

    // Format date for display
    function formatDate(dateStr) {
      const d = parseDate(dateStr);
      return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }

    // Get unique authors with counts
    function getAuthors() {
      const counts = {};
      TWEETS.forEach(t => {
        counts[t.author] = (counts[t.author] || 0) + 1;
      });
      return Object.entries(counts).sort((a, b) => b[1] - a[1]);
    }

    // Render author filters
    function renderAuthorFilters() {
      const container = document.getElementById('author-filters');
      const authors = getAuthors();
      container.innerHTML = authors.map(([author, count]) => `
        <label class="author-checkbox">
          <input type="checkbox" value="${author}" checked>
          @${author}
          <span class="count">${count}</span>
        </label>
      `).join('');

      // Add event listeners
      container.querySelectorAll('input').forEach(cb => {
        cb.addEventListener('change', applyFilters);
      });
    }

    // Get selected authors
    function getSelectedAuthors() {
      const checkboxes = document.querySelectorAll('#author-filters input:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // Apply all filters
    function applyFilters() {
      const selectedAuthors = getSelectedAuthors();
      const sortBy = document.getElementById('sort-by').value;
      const minLikes = parseInt(document.getElementById('min-likes').value) || 0;
      const minViews = parseInt(document.getElementById('min-views').value) || 0;
      const minSaves = parseInt(document.getElementById('min-saves').value) || 0;
      const dateFrom = document.getElementById('date-from').value;
      const dateTo = document.getElementById('date-to').value;
      const searchText = document.getElementById('search-text').value.toLowerCase();

      filteredTweets = TWEETS.filter(t => {
        // Author filter
        if (!selectedAuthors.includes(t.author)) return false;

        // Engagement filters
        if (t.likes < minLikes) return false;
        if (t.views < minViews) return false;
        if (t.saves < minSaves) return false;

        // Date filters
        if (dateFrom) {
          const tweetDate = parseDate(t.date);
          const fromDate = new Date(dateFrom);
          if (tweetDate < fromDate) return false;
        }
        if (dateTo) {
          const tweetDate = parseDate(t.date);
          const toDate = new Date(dateTo);
          toDate.setHours(23, 59, 59);
          if (tweetDate > toDate) return false;
        }

        // Search filter
        if (searchText && !t.text.toLowerCase().includes(searchText)) return false;

        return true;
      });

      // Sort
      filteredTweets.sort((a, b) => {
        switch (sortBy) {
          case 'likes': return b.likes - a.likes;
          case 'likes-asc': return a.likes - b.likes;
          case 'views': return b.views - a.views;
          case 'rts': return b.rts - a.rts;
          case 'saves': return b.saves - a.saves;
          case 'date-new': return parseDate(b.date) - parseDate(a.date);
          case 'date-old': return parseDate(a.date) - parseDate(b.date);
          case 'engagement-rate':
            const rateA = a.views > 0 ? (a.likes + a.rts + a.saves) / a.views : 0;
            const rateB = b.views > 0 ? (b.likes + b.rts + b.saves) / b.views : 0;
            return rateB - rateA;
          default: return b.likes - a.likes;
        }
      });

      currentBatch = 0;
      renderTweets();
      updateCounts();
    }

    // Render tweets
    function renderTweets(append = false) {
      const container = document.getElementById('tweets-grid');
      const start = append ? currentBatch * BATCH_SIZE : 0;
      const end = (currentBatch + 1) * BATCH_SIZE;
      const tweetsToShow = filteredTweets.slice(0, end);

      if (!append) {
        container.innerHTML = '';
      }

      const newTweets = filteredTweets.slice(start, end);

      if (newTweets.length === 0 && !append) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No tweets match your filters</h3>
            <p>Try adjusting your filter criteria</p>
          </div>
        `;
        document.getElementById('load-more').style.display = 'none';
        return;
      }

      newTweets.forEach((tweet, i) => {
        const globalIndex = start + i;
        const rankClass = globalIndex < 10 ? 'top-10' : globalIndex < 50 ? 'top-50' : '';

        const card = document.createElement('div');
        card.className = 'tweet-card';
        card.innerHTML = `
          <div class="rank-badge ${rankClass}">${globalIndex + 1}</div>
          <div class="tweet-header">
            <span class="tweet-author">@${tweet.author}</span>
            <span class="tweet-date">${formatDate(tweet.date)}</span>
          </div>
          <div class="tweet-text">${escapeHtml(tweet.text)}</div>
          <div class="tweet-metrics">
            <span class="metric metric-likes">
              <svg class="metric-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
              ${formatNumber(tweet.likes)}
            </span>
            <span class="metric metric-rts">
              <svg class="metric-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
              ${formatNumber(tweet.rts)}
            </span>
            <span class="metric metric-views">
              <svg class="metric-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              ${formatNumber(tweet.views)}
            </span>
            <span class="metric metric-saves">
              <svg class="metric-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>
              ${formatNumber(tweet.saves)}
            </span>
          </div>
          <div class="tweet-link">
            <a href="${tweet.url}" target="_blank">View on X →</a>
          </div>
        `;

        card.addEventListener('click', (e) => {
          if (e.target.tagName !== 'A') {
            window.open(tweet.url, '_blank');
          }
        });

        container.appendChild(card);
      });

      // Show/hide load more
      const loadMore = document.getElementById('load-more');
      if (end < filteredTweets.length) {
        loadMore.style.display = 'flex';
      } else {
        loadMore.style.display = 'none';
      }

      document.getElementById('visible-count').textContent = Math.min(end, filteredTweets.length);
    }

    // Update counts
    function updateCounts() {
      document.getElementById('filtered-count').textContent = filteredTweets.length;
      document.getElementById('showing-count').textContent = filteredTweets.length;
    }

    // Update header stats
    function updateHeaderStats() {
      document.getElementById('total-tweets').textContent = formatNumber(TWEETS.length);
      const totalLikes = TWEETS.reduce((sum, t) => sum + t.likes, 0);
      document.getElementById('total-likes').textContent = formatNumber(totalLikes);
    }

    // Escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Reset filters
    function resetFilters() {
      document.querySelectorAll('#author-filters input').forEach(cb => cb.checked = true);
      document.getElementById('sort-by').value = 'likes';
      document.getElementById('min-likes').value = '';
      document.getElementById('min-views').value = '';
      document.getElementById('min-saves').value = '';
      document.getElementById('date-from').value = '';
      document.getElementById('date-to').value = '';
      document.getElementById('search-text').value = '';
      applyFilters();
    }

    // Load data and initialize
    async function init() {
      try {
        const response = await fetch('data/all_tweets.json');
        TWEETS = await response.json();

        renderAuthorFilters();
        updateHeaderStats();
        applyFilters();

        // Event listeners
        document.getElementById('sort-by').addEventListener('change', applyFilters);
        document.getElementById('min-likes').addEventListener('input', debounce(applyFilters, 300));
        document.getElementById('min-views').addEventListener('input', debounce(applyFilters, 300));
        document.getElementById('min-saves').addEventListener('input', debounce(applyFilters, 300));
        document.getElementById('date-from').addEventListener('change', applyFilters);
        document.getElementById('date-to').addEventListener('change', applyFilters);
        document.getElementById('search-text').addEventListener('input', debounce(applyFilters, 300));
        document.getElementById('reset-filters').addEventListener('click', resetFilters);
        document.getElementById('load-more-btn').addEventListener('click', () => {
          currentBatch++;
          renderTweets(true);
        });
      } catch (error) {
        console.error('Failed to load tweets:', error);
        document.getElementById('tweets-grid').innerHTML = `
          <div class="empty-state">
            <h3>Failed to load tweets</h3>
            <p>Make sure you're running this from a local server (not file://)</p>
            <p style="margin-top: 16px; font-size: 0.75rem; color: #555;">
              Run: npx serve . <br>
              Then open: http://localhost:3000/dashboard.html
            </p>
          </div>
        `;
      }
    }

    // Debounce helper
    function debounce(fn, delay) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn.apply(this, args), delay);
      };
    }

    // Start
    init();
  </script>
</body>
</html>
